<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title><title><no title></title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css">
</head>
<body>
<h2><title><no title></title></h2>

<div class="highlight"><pre><span></span><span class="cm">/* Blob.js</span>
<span class="cm"> * A Blob implementation.</span>
<span class="cm"> * 2014-07-24</span>
<span class="cm"> *</span>
<span class="cm"> * By Eli Grey, http://eligrey.com</span>
<span class="cm"> * By Devin Samarin, https://github.com/dsamarin</span>
<span class="cm"> * License: MIT</span>
<span class="cm"> *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md</span>
<span class="cm"> */</span>

<span class="cm">/*global self, unescape */</span>
<span class="cm">/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,</span>
<span class="cm">  plusplus: true */</span>

<span class="cm">/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
	<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

	<span class="nx">view</span><span class="p">.</span><span class="nx">URL</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">URL</span> <span class="o">||</span> <span class="nx">view</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">Blob</span> <span class="o">&amp;&amp;</span> <span class="nx">view</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">try</span> <span class="p">{</span>
			<span class="k">new</span> <span class="nx">Blob</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
	<span class="p">}</span>

	<span class="c1">// Internally we use a BlobBuilder implementation to base Blob off of</span>
	<span class="c1">// in order to support older browsers that only have BlobBuilder</span>
	<span class="kd">var</span> <span class="nx">BlobBuilder</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">BlobBuilder</span> <span class="o">||</span> <span class="nx">view</span><span class="p">.</span><span class="nx">WebKitBlobBuilder</span> <span class="o">||</span> <span class="nx">view</span><span class="p">.</span><span class="nx">MozBlobBuilder</span> <span class="o">||</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span>
			  <span class="nx">get_class</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\[object\s(.*)\]$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="p">,</span> <span class="nx">FakeBlobBuilder</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">BlobBuilder</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
			<span class="p">}</span>
			<span class="p">,</span> <span class="nx">FakeBlob</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Blob</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">=</span> <span class="nx">encoding</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="p">,</span> <span class="nx">FBB_proto</span> <span class="o">=</span> <span class="nx">FakeBlobBuilder</span><span class="p">.</span><span class="nx">prototype</span>
			<span class="p">,</span> <span class="nx">FB_proto</span> <span class="o">=</span> <span class="nx">FakeBlob</span><span class="p">.</span><span class="nx">prototype</span>
			<span class="p">,</span> <span class="nx">FileReaderSync</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">FileReaderSync</span>
			<span class="p">,</span> <span class="nx">FileException</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">type</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="p">,</span> <span class="nx">file_ex_codes</span> <span class="o">=</span> <span class="p">(</span>
				  <span class="s2">&quot;NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR &quot;</span>
				<span class="o">+</span> <span class="s2">&quot;NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR&quot;</span>
			<span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
			<span class="p">,</span> <span class="nx">file_ex_code</span> <span class="o">=</span> <span class="nx">file_ex_codes</span><span class="p">.</span><span class="nx">length</span>
			<span class="p">,</span> <span class="nx">real_URL</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">URL</span> <span class="o">||</span> <span class="nx">view</span><span class="p">.</span><span class="nx">webkitURL</span> <span class="o">||</span> <span class="nx">view</span>
			<span class="p">,</span> <span class="nx">real_create_object_URL</span> <span class="o">=</span> <span class="nx">real_URL</span><span class="p">.</span><span class="nx">createObjectURL</span>
			<span class="p">,</span> <span class="nx">real_revoke_object_URL</span> <span class="o">=</span> <span class="nx">real_URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span>
			<span class="p">,</span> <span class="nx">URL</span> <span class="o">=</span> <span class="nx">real_URL</span>
			<span class="p">,</span> <span class="nx">btoa</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">btoa</span>
			<span class="p">,</span> <span class="nx">atob</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">atob</span>

			<span class="p">,</span> <span class="nx">ArrayBuffer</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">ArrayBuffer</span>
			<span class="p">,</span> <span class="nx">Uint8Array</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">Uint8Array</span>

			<span class="p">,</span> <span class="nx">origin</span> <span class="o">=</span> <span class="sr">/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/</span>
		<span class="p">;</span>
		<span class="nx">FakeBlob</span><span class="p">.</span><span class="nx">fake</span> <span class="o">=</span> <span class="nx">FB_proto</span><span class="p">.</span><span class="nx">fake</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="nx">file_ex_code</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">FileException</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">file_ex_codes</span><span class="p">[</span><span class="nx">file_ex_code</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">file_ex_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="c1">// Polyfill URL</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">real_URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">URL</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">URL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span>
					  <span class="nx">uri_info</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElementNS</span><span class="p">(</span><span class="s2">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
					<span class="p">,</span> <span class="nx">uri_origin</span>
				<span class="p">;</span>
				<span class="nx">uri_info</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s2">&quot;origin&quot;</span> <span class="k">in</span> <span class="nx">uri_info</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">uri_info</span><span class="p">.</span><span class="nx">protocol</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;data:&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">uri_info</span><span class="p">.</span><span class="nx">origin</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nx">uri_origin</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">origin</span><span class="p">);</span>
						<span class="nx">uri_info</span><span class="p">.</span><span class="nx">origin</span> <span class="o">=</span> <span class="nx">uri_origin</span> <span class="o">&amp;&amp;</span> <span class="nx">uri_origin</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">return</span> <span class="nx">uri_info</span><span class="p">;</span>
			<span class="p">};</span>
		<span class="p">}</span>
		<span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blob</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span>
				  <span class="nx">type</span> <span class="o">=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">type</span>
				<span class="p">,</span> <span class="nx">data_URI_header</span>
			<span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">blob</span> <span class="k">instanceof</span> <span class="nx">FakeBlob</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">data_URI_header</span> <span class="o">=</span> <span class="s2">&quot;data:&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;base64&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">data_URI_header</span> <span class="o">+</span> <span class="s2">&quot;;base64,&quot;</span> <span class="o">+</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;URI&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">data_URI_header</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">if</span> <span class="p">(</span><span class="nx">btoa</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">data_URI_header</span> <span class="o">+</span> <span class="s2">&quot;;base64,&quot;</span> <span class="o">+</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">data_URI_header</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">real_create_object_URL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">real_create_object_URL</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">real_URL</span><span class="p">,</span> <span class="nx">blob</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">};</span>
		<span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object_URL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">object_URL</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;data:&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">real_revoke_object_URL</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">real_revoke_object_URL</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">real_URL</span><span class="p">,</span> <span class="nx">object_URL</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">};</span>
		<span class="nx">FBB_proto</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="cm">/*, endings*/</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">bb</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
			<span class="c1">// decode data to a binary string</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">Uint8Array</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">data</span> <span class="k">instanceof</span> <span class="nx">ArrayBuffer</span> <span class="o">||</span> <span class="nx">data</span> <span class="k">instanceof</span> <span class="nx">Uint8Array</span><span class="p">))</span> <span class="p">{</span>
				<span class="kd">var</span>
					  <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
					<span class="p">,</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
					<span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="p">,</span> <span class="nx">buf_len</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">length</span>
				<span class="p">;</span>
				<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">buf_len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">str</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
				<span class="p">}</span>
				<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">get_class</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;Blob&quot;</span> <span class="o">||</span> <span class="nx">get_class</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;File&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">FileReaderSync</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">fr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReaderSync</span><span class="p">;</span>
					<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fr</span><span class="p">.</span><span class="nx">readAsBinaryString</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="c1">// async FileReader won&#39;t work as BlobBuilder is sync</span>
					<span class="k">throw</span> <span class="k">new</span> <span class="nx">FileException</span><span class="p">(</span><span class="s2">&quot;NOT_READABLE_ERR&quot;</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="k">instanceof</span> <span class="nx">FakeBlob</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;base64&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">atob</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;URI&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;raw&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">data</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="c1">// convert unsupported types to strings</span>
				<span class="p">}</span>
				<span class="c1">// decode UTF-16 to binary string</span>
				<span class="nx">bb</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">unescape</span><span class="p">(</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">data</span><span class="p">)));</span>
			<span class="p">}</span>
		<span class="p">};</span>
		<span class="nx">FBB_proto</span><span class="p">.</span><span class="nx">getBlob</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">type</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">FakeBlob</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">);</span>
		<span class="p">};</span>
		<span class="nx">FBB_proto</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s2">&quot;[object BlobBuilder]&quot;</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="nx">FB_proto</span><span class="p">.</span><span class="nx">slice</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">args</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">type</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">FakeBlob</span><span class="p">(</span>
				  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">args</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">end</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
				<span class="p">,</span> <span class="nx">type</span>
				<span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">encoding</span>
			<span class="p">);</span>
		<span class="p">};</span>
		<span class="nx">FB_proto</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s2">&quot;[object Blob]&quot;</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="nx">FB_proto</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="k">return</span> <span class="nx">FakeBlobBuilder</span><span class="p">;</span>
	<span class="p">}(</span><span class="nx">view</span><span class="p">));</span>

	<span class="nx">view</span><span class="p">.</span><span class="nx">Blob</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blobParts</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">?</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BlobBuilder</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">blobParts</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">blobParts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">Uint8Array</span> <span class="o">&amp;&amp;</span> <span class="nx">blobParts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">Uint8Array</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">builder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">blobParts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">buffer</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">builder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">blobParts</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">getBlob</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">blob</span><span class="p">.</span><span class="nx">slice</span> <span class="o">&amp;&amp;</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">webkitSlice</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">blob</span><span class="p">.</span><span class="nx">slice</span> <span class="o">=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">webkitSlice</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">blob</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="kd">var</span> <span class="nx">getPrototypeOf</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="nx">view</span><span class="p">.</span><span class="nx">Blob</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">getPrototypeOf</span><span class="p">(</span><span class="k">new</span> <span class="nx">view</span><span class="p">.</span><span class="nx">Blob</span><span class="p">());</span>
<span class="p">}(</span><span class="k">typeof</span> <span class="nx">self</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="k">this</span><span class="p">));</span>
</pre></div>
</body>
</html>
